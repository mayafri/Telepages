<html>
	<head>

		<script type="text/javascript">
			var socket;
			var lastCommand;
			var lastResponse;

			function Init() {
				var host = "ws://localhost:9000";
				socket = new WebSocket(host);
	
				socket.onopen = function(msg) { 
					console.log(this.readyState); 
				};
				socket.onmessage = function(msg) { 
					var output = msg.data.split('\x1E');
					OnMessage(output[0].split('\x1F'), output[1]);
				};
			}

			function OnMessage(lastCommand, lastResponse) {
				if (lastCommand[0] == 'AddBookmark') {
					document.getElementById('book').innerHTML += '<li><a href="'+lastCommand[2]+'">'+lastCommand[1]+'</a></li>';
				}
				else if (lastCommand[0] == 'GetBookmarks') {
					document.getElementById('book').innerHTML = lastResponse;
				}
			}

			function Wait(fnct) {
				setTimeout(
					function () {
						if (socket.readyState === 1) {
							fnct();
						}
						else {
							Wait(fnct)
						}
					}, 5);
			}

			function Send(msg) {
				Wait(function () { socket.send(msg) });
			}

			function Quit() {
				if (socket != null) {
					socket.close();
					socket=null;
				}
			}

			function AddBookmark() {
				var name = window.prompt("Nom du marque-page ?","");
				var url = window.prompt("URL ?","http://");
				Send('AddBookmark\x1F'+name+'\x1F'+url+'\x1F');
			}

			Init();
			Send('GetBookmarks');
		</script>

	</head>
	<body>
		<ul>
			<span id="book"></span>
		</ul>
		<button onclick="AddBookmark()">Send</button>
	</body>
</html>

